<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Relacionamento das bases no relatório operacional: método Concatenate x Linktable</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/splor-mg/notas" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Relacionamento das bases no relatório operacional: método Concatenate x Linktable</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introdução" class="level1">
<h1>Introdução</h1>
<p>As bases que compõem o relatório operacional, painel de dados de uso na SPLOR que utiliza a ferramenta de BI qlikview, são provenientes do <a href="http://www.armazem.mg.gov.br/">armazém B.O</a>, universos SIAFI e SIAD, e também das bases de Restimativa de Despesa e Receita, que atualmente se encontram compartilhadas no OneDrive e são periodicamente atualizadas pelas equipes da DCMEFO e DCAF.</p>
<p>Essas bases têm como característica apresentar diferentes granularidades (dimensões) nos dados entre elas, em razão das especificidades inerentes a natureza dos fluxos a que pertencem. E como será mostrado ao longo desta nota, isso acarreta em um desafio adicional ao usuário desenvolvedor do qlikview na tarefa de relacioná-las e gerar visualizações.</p>
<p>O objetivo desta nota é apresentar as diferentens granularidades de cada uma das bases, bem como comparar o método de empilhamento das bases (mais intuitivo a usuários iniciantes), com o método <a href="QlikView_Technical_Brief-Concatenate-and-Link-tables.pdf">linktable</a>, solução encontrada para relacionar as bases do retório operacional.</p>
</section>
<section id="as-diferentes-granularidades-das-bases-que-alimentam-o-relatório-operacional-qlikview" class="level1">
<h1>As diferentes granularidades das bases que alimentam o relatório operacional qlikview:</h1>
<p>O qlikview é uma ferramenta de selfservice BI, que permite que usuários com conhecimento de comandos básicos da ferramenta sejam capazes de criar suas próprias visualizações. A forma mais intuitiva, e geralmente mais a utilizada por esses usuários, é empilhar todas as bases que se deseja utilizar, por meio do comando <code>Concatenate</code> no <code>Script</code> do aplicativo. Este método é satisfatório quando inexiste diferença de granularidade nas bases. Entretanto, no caso das bases do relatório operacional, que apresentam diferentes granularidades entre suas bases, o empilhamento em uma única base traz problemas ao usuário da ferramenta, ilustrados no tópico a seguir.</p>
<p>As diferentes granularidades (dimensões) dos dados pode ser verificada por meio do ementário completo das bases do projeto disponível em <a href="https://gist.github.com/hslinhares/68a3d06eae13b8facb1df42e1095c49e">data package relatorio operacional</a>.</p>
<p>Para exemplificar os métodos de empilhamento (concatenate) e linktable nesta nota, são utilizados como amostra, as bases de Execução da Despesa, Crédito Inicial e Autorizado, e Aprovação de Cota Orçamentária, todas do exercício 2022 e provenientes do armazém B.O.</p>
</section>
<section id="empilhamento-das-bases-método-concatenate-no-qlikview" class="level1">
<h1>Empilhamento das bases (método concatenate) no qlikview:</h1>
<p>Acessando o <code>Script</code> do qlikview, por meio do <code>ctrl E</code>, os seguintes passos devem ser seguidos:</p>
<section id="passo-1-empilhar-as-bases-mensais-da-execução-da-despesa-2022" class="level2">
<h2 class="anchored" data-anchor-id="passo-1-empilhar-as-bases-mensais-da-execução-da-despesa-2022">Passo 1: Empilhar as bases mensais da Execução da Despesa 2022:</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>//cria uma tabela temporária com a execução de todos os meses de 2022.</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>execucao_temp:</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>LOAD ANO, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>     MES, </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>     UO_COD, </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>     UE_COD, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>     UO_FINAN, </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>     UPG_COD, </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>     EMPENHO_NUM, </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>     FUNCAO_COD, </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>     ACAO_COD, </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>     GRUPO_COD, </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>     MODALIDADE_COD, </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>     IAG_COD, </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>     FONTE_COD, </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>     IPU_COD, </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>     PROCESSO_NUMERO, </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>     CONTRATO_ENTRADA, </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>     OBRA_NUMERO, </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>     CONTRATO_NUMERO, </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>     ELEMENTO_ITEM_COD, </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>     ELEMENTO_ORIGEM_DEA_COD, </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>     ITEM_ORIGEM_DEA_COD, </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>     CREDOR_CNPJ_CPF, </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>     DESPESA_EMP, </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>     DESPESA_LIQ, </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>     DESPESA_PAGA_ORC, </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>     DESPESA_PAGA_FIN</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>FROM</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>[data-raw\execucao_2022*]</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>(ooxml, embedded labels, table is base);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="passo-2-empilhar-as-bases-crédito-inicial-e-autorizado-e-aprovação-de-cota-orçamentária-2022-na-tabela-de-execução-criada-no-passo-anterior" class="level2">
<h2 class="anchored" data-anchor-id="passo-2-empilhar-as-bases-crédito-inicial-e-autorizado-e-aprovação-de-cota-orçamentária-2022-na-tabela-de-execução-criada-no-passo-anterior">Passo 2: Empilhar as bases Crédito Inicial e Autorizado, e Aprovação de Cota Orçamentária 2022 na tabela de Execução criada no passo anterior:</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>//Cria uma tabela com os dados de execução, crédito inicial e autorizado, cota orçamentária e exclui a tabela temporária de execução utilizada para empillhar as bases mensais.</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>NoConcatenate</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>execucao:</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>LOAD ANO, </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>     MES, </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>     UO_COD, </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>     UE_COD, </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>     UO_FINAN, </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>     UPG_COD, </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>     EMPENHO_NUM, </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>     FUNCAO_COD, </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>     ACAO_COD, </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>     GRUPO_COD, </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>     MODALIDADE_COD, </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>     IAG_COD, </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>     FONTE_COD, </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>     IPU_COD, </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>     PROCESSO_NUMERO, </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>     CONTRATO_ENTRADA, </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>     OBRA_NUMERO, </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>     CONTRATO_NUMERO, </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>     ELEMENTO_ITEM_COD, </span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>     ELEMENTO_ORIGEM_DEA_COD, </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>     ITEM_ORIGEM_DEA_COD, </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>     CREDOR_CNPJ_CPF, </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>     DESPESA_EMP, </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>     DESPESA_LIQ, </span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>     DESPESA_PAGA_ORC, </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>     DESPESA_PAGA_FIN</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>Resident execucao_temp;</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>Concatenate</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>credito:</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>LOAD ANO, </span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>     UO_COD, </span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>     ACAO_COD, </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>     GRUPO_COD, </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>     IAG_COD, </span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>     FONTE_COD, </span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>     IPU_COD, </span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>     CREDITO_INICIAL, </span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>     CREDITO_AUTORIZADO</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>FROM</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>[data-raw\credito-inicial-autorizado_2022.xlsx]</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>(ooxml, embedded labels, table is base);</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>Concatenate</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>cota:</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>LOAD ANO, </span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>     UO_COD, </span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>     GRUPO_COD, </span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>     IAG_COD, </span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>     FONTE_COD, </span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>     IPU_COD, </span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>     ACAO_COD, </span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>     ELEMENTO_ITEM_COD, </span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>     [COTA APROVADA LIQUIDA]</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>FROM</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>[data-raw\cota-item-data_2022.xlsx]</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>(ooxml, embedded labels, table is base);</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>drop table execucao_temp; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="resultado" class="level2">
<h2 class="anchored" data-anchor-id="resultado">Resultado</h2>
<p>Após seguir os passos anteriores e dar o comando <code>ctrl R</code> no script do qlikview para leitura das bases, o resultado será uma única tabela de dados empilhada, que pode ser verificada por meio do comando <code>ctrl T</code>, vide figura a seguir:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figuras/base_empilhada.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">base empilhada</figcaption>
</figure>
</div>
</section>
<section id="criação-de-dashboards-no-método-de-empilhamento-das-bases-concatenate" class="level2">
<h2 class="anchored" data-anchor-id="criação-de-dashboards-no-método-de-empilhamento-das-bases-concatenate">Criação de <em>dashboards</em> no método de empilhamento das bases (Concatenate):</h2>
<p>Com as bases lidas, dentro da aba de criação de <em>dashboards</em> no qlikview, o próximo passo é inserir <code>Novo Objeto de Pasta</code> do tipo <code>Lista</code> para objetos de filtro e <code>Gráfico</code>/<code>Tabela Simples</code> para criação da Tabela com os dados desejados.</p>
<p>No exemplo foi criada a Tabela 1 em que são visualizados dados de 2022 de Crédito Orçamentário, Cota Aprovada, Despesa Empenhada e Despesa Liquidada, por Unidade Orçamentária, Grupo de Despesa, Fonte de Recursos e Procedência. E como filtro, as dimensões Unidade Orçamentária (UO_COD), Ação (ACAO_COD), Grupo de Despesa (GRUPO_COD), Elemento Item de Despesa (ELEMENTO_ITEM_COD) e Número do Contrato (CONTRATO_NUMERO).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figuras/concatenate_painel.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">base empilhada</figcaption>
</figure>
</div>
</section>
<section id="utilização-dos-filtros-e-resultados-no-método-de-empilhamento-concatenate" class="level2">
<h2 class="anchored" data-anchor-id="utilização-dos-filtros-e-resultados-no-método-de-empilhamento-concatenate">Utilização dos filtros e resultados no método de empilhamento (concatenate)</h2>
<p>Nos campos de filtro é possível se fazer a seleção desejada nos dados. Quando se filtra por dimensões existentes em todas as bases, como no exemplo, UO_COD, ACAO_COD ou GRUPO_COD, a tabela retorna valores desejados.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figuras/concatenate_filtro-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">base empilhada</figcaption>
</figure>
</div>
<p>Contudo, quando se filtra por alguma dimensão não existente em alguma das bases da Tabela 1, seus dados retornam zerados. Neste exemplo, ao se filtrar por Elemento Item, os dados de Crédito Inicial e Autorizado retornam zero, por suas bases não conterem esta dimensão.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figuras/concatenate_filtro-2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">base empilhada</figcaption>
</figure>
</div>
<p>A visualização mais informativa neste caso seria o retorno do Crédito Inicial e Autorizado na estrutura orçamentária em que houve a execução de despesas no Elemento Item selecionado; neste exemplo, UO_COD = 1501, ACAO_COD = 2500 e GRUPO_COD = 3.</p>
<p>O mesmo problema ocorre ao filtramos por algum contrato. Neste caso, além do Crédito Inicial e Autorizado, a Cota Aprovada também retorna zero, pois inexiste essa dimensão nas bases a que pertencem. Do mesmo modo, a visualização desejada seria o retorno dos dados de Crédito Inicial e Autorizado e Cota Aprovada, na estrutura orçamentária em que houve a execução da despesa no contrato selecionado.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figuras/concatenate_filtro-3.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">base empilhada</figcaption>
</figure>
</div>
</section>
</section>
<section id="relacionamento-de-bases-por-linktable-no-qlikview" class="level1">
<h1>Relacionamento de bases por <em>Linktable</em> no qlikview:</h1>
<p>O método de relacionamento <a href="QlikView_Technical_Brief-Concatenate-and-Link-tables.pdf">linktable</a> consiste em se juntar em uma única tabela as dimensões de todas as bases (No exemplo: UO, AÇÃO, GRUPO, FONTE, IPU, e etc.), criando-se a tabela dimensão, e por meio de chaves fazer o relacionamento com as tabelas fato, ou seja, os dados do négócio (Crédito Inicial e Autorizado, Cota Aprovada, Despesa Empenhada e Liquidada, e etc.)</p>
</section>
<section id="método-linktable-no-qlikview" class="level1">
<h1>Método linktable no qlikview</h1>
<p>Vamos utilizar as mesmas bases utilizadas no exemplo anterior do método de empilhamento das bases para comparação dos resultados.</p>
<p>Acessando o <code>Script</code> do qlikview, por meio do <code>ctrl E</code>, os seguintes passos devem ser seguidos:</p>
<section id="passo-1-empilhar-as-bases-mensais-da-execução-da-despesa-2022-1" class="level2">
<h2 class="anchored" data-anchor-id="passo-1-empilhar-as-bases-mensais-da-execução-da-despesa-2022-1">Passo 1: Empilhar as bases mensais da Execução da Despesa 2022:</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>//cria uma tabela temporária com a execução de todos os meses de 2022.</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>execucao_temp:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>LOAD ANO, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>     MES, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>     UO_COD, </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>     UE_COD, </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>     UO_FINAN, </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>     UPG_COD, </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>     EMPENHO_NUM, </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>     FUNCAO_COD, </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>     ACAO_COD, </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>     GRUPO_COD, </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>     MODALIDADE_COD, </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>     IAG_COD, </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>     FONTE_COD, </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>     IPU_COD, </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>     PROCESSO_NUMERO, </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>     CONTRATO_ENTRADA, </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>     OBRA_NUMERO, </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>     CONTRATO_NUMERO, </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>     ELEMENTO_ITEM_COD, </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>     ELEMENTO_ORIGEM_DEA_COD, </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>     ITEM_ORIGEM_DEA_COD, </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>     CREDOR_CNPJ_CPF, </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>     DESPESA_EMP, </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>     DESPESA_LIQ, </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>     DESPESA_PAGA_ORC, </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>     DESPESA_PAGA_FIN</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>FROM</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>[data-raw\execucao_2022*]</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>(ooxml, embedded labels, table is base);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>//Cria a chave1 na tabela fato e torna as variavéis dimensão como comentário no Script

NoConcatenate

execucao:
LOAD 
ANO&amp;'|'&amp;MES&amp;'|'&amp;UO_COD&amp;'|'&amp;UE_COD&amp;'|'&amp;UO_FINAN &amp;'|'&amp;UPG_COD&amp;'|'&amp;EMPENHO_NUM&amp;'|'&amp;FUNCAO_COD&amp;'|'&amp;ACAO_COD&amp;'|'&amp;GRUPO_COD&amp;'|'&amp;MODALIDADE_COD&amp;'|'&amp;IAG_COD&amp;'|'&amp;FONTE_COD&amp;'|'&amp;IPU_COD&amp;'|'&amp;PROCESSO_NUMERO&amp;'|'&amp;CONTRATO_ENTRADA&amp;'|'&amp;OBRA_NUMERO&amp;'|'&amp;CONTRATO_NUMERO&amp;'|'&amp;ELEMENTO_ITEM_COD&amp;'|'&amp;ELEMENTO_ORIGEM_DEA_COD&amp;'|'&amp;ITEM_ORIGEM_DEA_COD&amp;'|'&amp;CREDOR_CNPJ_CPF as chave1,
     //ANO, 
     //MES, 
     //UO_COD, 
     //UE_COD, 
     // UO_FINAN, 
     // UPG_COD, 
     // EMPENHO_NUM, 
     // FUNCAO_COD, 
     //ACAO_COD, 
     // GRUPO_COD, 
     //MODALIDADE_COD, 
     // IAG_COD, 
     // FONTE_COD, 
     //IPU_COD, 
     //PROCESSO_NUMERO, 
     //CONTRATO_ENTRADA, 
     //OBRA_NUMERO, 
     // CONTRATO_NUMERO, 
     // ELEMENTO_ITEM_COD, 
     // ELEMENTO_ORIGEM_DEA_COD, 
     //ITEM_ORIGEM_DEA_COD, 
     // CREDOR_CNPJ_CPF, 
     DESPESA_EMP, 
     DESPESA_LIQ, 
     DESPESA_PAGA_ORC, 
     DESPESA_PAGA_FIN
Resident execucao_temp;
</code></pre>
<pre><code>//Cria a chave2 na tabela fato e torna as variavéis dimensão como comentário no Script

credito:
LOAD
ANO&amp;'|'&amp;UO_COD&amp;'|'&amp;ACAO_COD&amp;'|'&amp;GRUPO_COD&amp;'|'&amp;IAG_COD&amp;'|'&amp;FONTE_COD&amp;'|'&amp;IPU_COD as chave2,
//ANO, 
//UO_COD, 
//ACAO_COD, 
//GRUPO_COD, 
//IAG_COD, 
//FONTE_COD, 
//IPU_COD, 
//CREDITO_INICIAL, 
//CREDITO_AUTORIZADO
FROM
[data-raw\credito-inicial-autorizado_2022.xlsx]
(ooxml, embedded labels, table is base);</code></pre>
<pre><code>//Cria a chave3 na tabela fato e torna as variavéis dimensão como comentário no Script

cota:
LOAD 
ANO&amp;'|'&amp;UO_COD&amp;'|'&amp;ACAO_COD&amp;'|'&amp;GRUPO_COD&amp;'|'&amp;IAG_COD&amp;'|'&amp;FONTE_COD&amp;'|'&amp;IPU_COD&amp;'|'&amp;ELEMENTO_ITEM_COD as chave3,
//[Ano de Exercício], 
//UO_COD,
//ACAO_COD, 
//GRUPO_COD, 
//IAG_COD, 
//FONTE_COD, 
//IPU_COD, 
//ELEMENTO_ITEM_COD, 
[COTA APROVADA LIQUIDA]
FROM
[data-raw\cota-item-data_2022.xlsx]
(ooxml, embedded labels, table is base);
</code></pre>
<pre><code>//cria a tabela link contendo todas as dimensões de todas as bases e cria chaves para comunicar com as tabelas fato
//inserindo as dimensões da base de Execução de Despesas
NoConcatenate

link:
LOAD Distinct
ANO&amp;'|'&amp;MES&amp;'|'&amp;UO_COD&amp;'|'&amp;UE_COD&amp;'|'&amp;UO_FINAN &amp;'|'&amp;UPG_COD&amp;'|'&amp;EMPENHO_NUM&amp;'|'&amp;FUNCAO_COD&amp;'|'&amp;ACAO_COD&amp;'|'&amp;GRUPO_COD&amp;'|'&amp;MODALIDADE_COD&amp;'|'&amp;IAG_COD&amp;'|'&amp;FONTE_COD&amp;'|'&amp;IPU_COD&amp;'|'&amp;PROCESSO_NUMERO&amp;'|'&amp;CONTRATO_ENTRADA&amp;'|'&amp;OBRA_NUMERO&amp;'|'&amp;CONTRATO_NUMERO&amp;'|'&amp;ELEMENTO_ITEM_COD&amp;'|'&amp;ELEMENTO_ORIGEM_DEA_COD&amp;'|'&amp;ITEM_ORIGEM_DEA_COD&amp;'|'&amp;CREDOR_CNPJ_CPF as chave1, 
ANO&amp;'|'&amp;UO_COD&amp;'|'&amp;ACAO_COD&amp;'|'&amp;GRUPO_COD&amp;'|'&amp;IAG_COD&amp;'|'&amp;FONTE_COD&amp;'|'&amp;IPU_COD as chave2,
ANO&amp;'|'&amp;UO_COD&amp;'|'&amp;ACAO_COD&amp;'|'&amp;GRUPO_COD&amp;'|'&amp;IAG_COD&amp;'|'&amp;FONTE_COD&amp;'|'&amp;IPU_COD&amp;'|'&amp;ELEMENTO_ITEM_COD as chave3,
ANO,
MES,
UO_COD,
UE_COD,
UO_FINAN, 
UPG_COD,
EMPENHO_NUM,
FUNCAO_COD,
ACAO_COD,
GRUPO_COD,
MODALIDADE_COD,
IAG_COD,
FONTE_COD,
IPU_COD,
PROCESSO_NUMERO,
CONTRATO_ENTRADA,
OBRA_NUMERO,
CONTRATO_NUMERO,
ELEMENTO_ITEM_COD,
ELEMENTO_ORIGEM_DEA_COD,
ITEM_ORIGEM_DEA_COD,
CREDOR_CNPJ_CPF
resident execucao_temp;

Concatenate

//cria a tabela link contendo todas as dimensões de todas as bases e cria chaves para comunicar com as tabelas fato
//inserindo as dimensões da base de Crédito Inicial e Autorizado
link:
LOAD Distinct
null() as chave1,
ANO&amp;'|'&amp;UO_COD&amp;'|'&amp;ACAO_COD&amp;'|'&amp;GRUPO_COD&amp;'|'&amp;IAG_COD&amp;'|'&amp;FONTE_COD&amp;'|'&amp;IPU_COD as chave2,
null() as chave3,
ANO,
UO_COD,
ACAO_COD,
GRUPO_COD,
IAG_COD,
FONTE_COD,
IPU_COD 
FROM
[data-raw\credito-inicial-autorizado_2022.xlsx]
(ooxml, embedded labels, table is base);

Concatenate

//cria a tabela link contendo todas as dimensões de todas as bases e cria chaves para comunicar com as tabelas fato
//inserindo as dimensões da base de Cota Aprovada
link:
LOAD Distinct
null () as chave1,
ANO&amp;'|'&amp;UO_COD&amp;'|'&amp;ACAO_COD&amp;'|'&amp;GRUPO_COD&amp;'|'&amp;IAG_COD&amp;'|'&amp;FONTE_COD&amp;'|'&amp;IPU_COD as chave2,
ANO&amp;'|'&amp;UO_COD&amp;'|'&amp;ACAO_COD&amp;'|'&amp;GRUPO_COD&amp;'|'&amp;IAG_COD&amp;'|'&amp;FONTE_COD&amp;'|'&amp;IPU_COD&amp;'|'&amp;ELEMENTO_ITEM_COD as chave3,
ANO,
UO_COD,
ACAO_COD,
GRUPO_COD,
IAG_COD,
FONTE_COD,
IPU_COD,
ELEMENTO_ITEM_COD
FROM
[data-raw\cota-item-data_2022.xlsx]
(ooxml, embedded labels, table is base);

</code></pre>
</section>
<section id="resultado-1" class="level2">
<h2 class="anchored" data-anchor-id="resultado-1">Resultado</h2>
<p>Após seguir os passos anteriores e dar o comando <code>ctrl R</code> no script do qlikview, o resultado serão uma única tabela dimensão ligada as tabelas fato por meio de chaves, verificada por meio do comando <code>ctrl T</code>, conforme figura a seguir:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figuras/linktable.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">base empilhada</figcaption>
</figure>
</div>
</section>
<section id="criação-de-dashboards-no-método-linktable" class="level2">
<h2 class="anchored" data-anchor-id="criação-de-dashboards-no-método-linktable">Criação de <em>dashboards</em> no método <em>Linktable</em>:</h2>
<p>De maneira análoga ao exemplo anterior de empilhamento de bases, foram utilizados os mesmos campos para criação da Tabela 2 e os filtros. Os dados totais sem filtro são exatamente iguais aos da Tabela 1.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figuras/linktable_painel.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">base empilhada</figcaption>
</figure>
</div>
</section>
<section id="utilização-dos-filtros-e-resultados-no-método-linktable" class="level2">
<h2 class="anchored" data-anchor-id="utilização-dos-filtros-e-resultados-no-método-linktable">Utilização dos filtros e resultados no método <em>linktable</em></h2>
<p>Ao se filtrar por alguma dimensão comum entre todas as bases das variáveis que compõem a Tabela 2, o resultado é o mesmo da Tabela 1, retornando dados corretamente.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figuras/linktable_filtro-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">base empilhada</figcaption>
</figure>
</div>
<p>A diferença entre o método de empilhamento e o linktable ocorre ao se filtrar por alguma dimensão que inexiste em alguma das bases das variáveis que compõem a Tabela 2. Neste Caso, diferente do exemplo da Tabela 1, ao se filtrar por exemplo por Elemento Item, os dados de Crédito Inicial e Autorizado retornarão dados da estrutura orçamentária em que a houve Execução de Despesa, e/ou Aprovação de Cota.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figuras/linktable_filtro-2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">base empilhada</figcaption>
</figure>
</div>
<p>O mesmo ocorre quando se filtra por algum contrato, em que haverá o retorno de dados de Crédito Inicial e Autorizado e Cota Aprovada na estrutura orçamentária em que a Execução da Despesa nesse contrato ocorreu.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figuras/linktable_filtro-3.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">base empilhada</figcaption>
</figure>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/splor-mg/notas/edit/main/20231804T160439/index.md" class="toc-action">Edit this page</a></p><p><a href="https://github.com/splor-mg/notas/issues/new" class="toc-action">Report an issue</a></p></div></div></div></div></footer></body></html>